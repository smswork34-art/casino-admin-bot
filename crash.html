<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ORANGEW1N ‚Äî CRASH</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* ===== –ü–û–õ–ù–û–°–¢–¨–Æ –°–¢–ò–õ–¨ –ò–ó INDEX (5).html ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #FF6B00;
            --primary-dark: #FF4500;
            --primary-light: #FF8C00;
            --secondary: #00C2FF;
            --success: #00C853;
            --danger: #FF3D00;
            --warning: #FF9800;
            --bg-dark: #0A0A0A;
            --bg-card: #111111;
            --bg-sidebar: #0D0D0D;
            --bg-header: #0A0A0A;
            --text-primary: #FFFFFF;
            --text-secondary: #9B9B9B;
            --border: #252525;
            --gradient: linear-gradient(135deg, #FF6B00, #FF4500);
            --gradient-blue: linear-gradient(135deg, #00C2FF, #0088CC);
            --bottom-nav: #0D0D0D;
            --card-bg: #1A1A1A;
            --success-gradient: linear-gradient(135deg, #00C853, #00B248);
            --danger-gradient: linear-gradient(135deg, #FF3D00, #D32F2F);
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }

        .app {
            max-width: 500px;
            width: 100%;
            margin: 0 auto;
            position: relative;
            background: var(--bg-dark);
            border-radius: 24px;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        }

        /* –®–∞–ø–∫–∞ */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-dark);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }

        .logo-mini {
            font-size: 20px;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
            cursor: pointer;
        }

        .top-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .balance-chip {
            background: var(--card-bg);
            border-radius: 100px;
            padding: 8px 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid var(--border);
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
        }

        .balance-chip i {
            color: var(--primary);
            font-size: 14px;
        }

        .avatar-btn {
            width: 42px;
            height: 42px;
            background: var(--gradient);
            border-radius: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        /* ===== –°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–ï –°–¢–ò–õ–ò –î–õ–Ø CRASH (–í –°–¢–ò–õ–ï INDEX) ===== */
        .game-content {
            padding: 20px 16px;
            background: var(--bg-dark);
        }

        .game-title {
            font-size: 24px;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            text-align: center;
        }

        .game-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 20px;
            text-align: center;
        }

        .crash-display {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .crash-graph {
            width: 100%;
            height: 180px;
            margin-bottom: 20px;
            position: relative;
            background: var(--bg-dark);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .graph-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
            transform-origin: left center;
            box-shadow: 0 0 15px rgba(255,107,0,0.5);
        }

        .crash-points {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .crash-point {
            background: rgba(255,61,0,0.2);
            color: var(--danger);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .multiplier-display {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 15px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .multiplier-display.running {
            color: var(--success);
            text-shadow: 0 0 20px rgba(0,200,83,0.5);
            animation: pulse 1s infinite;
        }

        .multiplier-display.crashed {
            color: var(--danger);
            text-shadow: 0 0 20px rgba(255,61,0,0.5);
            animation: crashShake 0.5s ease-out;
        }

        .multiplier-display.waiting {
            color: var(--text-secondary);
        }

        .status-message {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            min-height: 20px;
        }

        .bet-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .section-title {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .bet-label {
            display: block;
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .amount-input-container {
            display: flex;
            align-items: center;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 4px;
            transition: all 0.2s;
        }

        .amount-input-container:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255,107,0,0.2);
        }

        .amount-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 18px;
            padding: 12px 16px;
            outline: none;
            font-weight: 700;
        }

        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .quick-amount {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 5px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .quick-amount:hover {
            background: rgba(255,107,0,0.1);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .auto-cashout-section {
            margin-bottom: 20px;
        }

        .auto-cashout-value {
            text-align: center;
            font-size: 18px;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .auto-cashout-slider {
            width: 100%;
            margin: 15px 0;
        }

        .auto-cashout-label {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 5px;
        }

        .game-controls {
            display: flex;
            gap: 12px;
        }

        .game-button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .start-button {
            background: var(--gradient);
            color: white;
        }

        .start-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,107,0,0.4);
        }

        .cashout-button {
            background: var(--success-gradient);
            color: white;
        }

        .cashout-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,200,83,0.4);
        }

        .auto-toggle {
            background: var(--bg-dark);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .auto-toggle.active {
            background: var(--gradient);
            color: white;
            border-color: var(--primary);
        }

        .game-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .history-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .history-list {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 4px;
            min-height: 56px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--border);
        }

        .history-list::-webkit-scrollbar {
            height: 4px;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .history-item {
            min-width: 70px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 14px;
            flex-shrink: 0;
        }

        .history-crash {
            background: rgba(255,61,0,0.1);
            color: var(--danger);
            border: 1px solid rgba(255,61,0,0.3);
        }

        .history-cashout {
            background: rgba(0,200,83,0.1);
            color: var(--success);
            border: 1px solid rgba(0,200,83,0.3);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes crashShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* –ü—Ä–æ—Ñ–∏–ª—å –º–µ–Ω—é */
        .profile-menu {
            position: fixed;
            top: 70px;
            right: 16px;
            background: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            width: 300px;
            max-width: calc(100vw - 32px);
            border: 1px solid var(--border);
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            z-index: 1001;
            display: none;
        }

        .profile-menu.active {
            display: block;
            animation: fadeIn 0.2s;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(4px);
            z-index: 998;
            display: none;
        }

        .menu-overlay.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification {
            position: fixed;
            top: 70px;
            right: 15px;
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 12px 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            z-index: 1000;
            max-width: calc(100vw - 30px);
            transform: translateX(400px);
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
        }

        .notification.show { transform: translateX(0); }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--bg-dark);
            outline: none;
            -webkit-appearance: none;
            border: 1px solid var(--border);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 3px solid var(--bg-dark);
            box-shadow: 0 0 10px rgba(255,107,0,0.5);
        }

        @media (max-width: 400px) {
            .quick-icon { width: 58px; height: 58px; font-size: 24px; }
            .floating-deposit { padding: 12px 24px; font-size: 14px; bottom: 90px; }
            .multiplier-display { font-size: 42px; }
            .crash-graph { height: 160px; }
            .game-controls { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="top-bar">
            <div class="logo-mini" onclick="window.location.href='index.html'">ORANGEW1N</div>
            <div class="top-actions">
                <div class="balance-chip" id="balanceChip">
                    <i class="fas fa-coins"></i>
                    <span class="balance-number" id="mainBalance">0</span> ‚ÇΩ
                </div>
                <div class="avatar-btn" id="avatarBtn">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>

        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ CRASH -->
        <div class="game-content">
            <h1 class="game-title">üöÄ CRASH</h1>
            <p class="game-subtitle">–ó–∞–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å–≥–∏ –¥–æ –∫—Ä–∞—à–∞!</p>
            
            <div class="crash-display">
                <div class="crash-graph" id="crashGraph">
                    <div class="graph-line" id="graphLine"></div>
                    <div class="crash-points" id="crashPoints"></div>
                </div>
                
                <div class="multiplier-display waiting" id="multiplierDisplay">
                    1.00x
                </div>
                
                <div class="status-message" id="statusMessage">
                    –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢
                </div>
            </div>
            
            <div class="bet-section">
                <div class="bet-amount">
                    <label class="bet-label">–°–£–ú–ú–ê –°–¢–ê–í–ö–ò (‚ÇΩ)</label>
                    <div class="amount-input-container">
                        <input type="number" id="betAmount" class="amount-input" value="100" min="1">
                    </div>
                    
                    <div class="quick-amounts">
                        <div class="quick-amount" data-amount="50">50 ‚ÇΩ</div>
                        <div class="quick-amount" data-amount="100">100 ‚ÇΩ</div>
                        <div class="quick-amount" data-amount="500">500 ‚ÇΩ</div>
                        <div class="quick-amount" data-amount="1000">1000 ‚ÇΩ</div>
                        <div class="quick-amount" id="halfBalance">¬Ω –±–∞–ª–∞–Ω—Å–∞</div>
                        <div class="quick-amount" id="maxBalance">–ú–ê–ö–°</div>
                    </div>
                </div>
                
                <div class="auto-cashout-section">
                    <label class="bet-label">–ê–í–¢–û-–í–´–í–û–î</label>
                    <div class="auto-cashout-value" id="autoCashoutValue">2.00x</div>
                    <input type="range" id="autoCashoutSlider" class="auto-cashout-slider" min="1.1" max="10" step="0.1" value="2">
                    <div class="auto-cashout-label">
                        <span>1.10x</span>
                        <span>10.00x</span>
                    </div>
                </div>
                
                <div class="game-controls">
                    <button class="game-button start-button" id="startButton">
                        <i class="fas fa-play"></i>
                        –°–¢–ê–†–¢
                    </button>
                    <button class="game-button cashout-button" id="cashoutButton" disabled>
                        <i class="fas fa-money-bill-wave"></i>
                        –ó–ê–ë–†–ê–¢–¨
                    </button>
                    <button class="game-button auto-toggle" id="autoToggle">
                        <i class="fas fa-robot"></i>
                        –ê–í–¢–û
                    </button>
                </div>
            </div>
            
            <div class="history-section">
                <div class="section-title">–ü–û–°–õ–ï–î–ù–ò–ï –ö–†–ê–®–ò</div>
                <div class="history-list" id="historyList"></div>
            </div>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –∏ –ø—Ä–æ—Ñ–∏–ª—å -->
    <div class="menu-overlay" id="menuOverlay"></div>
    <div class="profile-menu" id="profileMenu">
        <div class="profile-header" style="display:flex; align-items:center; gap:12px; margin-bottom:15px; padding-bottom:12px; border-bottom:1px solid var(--border);">
            <div style="width:50px; height:50px; background:var(--gradient); border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:22px;">
                <i class="fas fa-user"></i>
            </div>
            <div>
                <h3 id="profileUsername" style="font-size:16px; margin-bottom:3px;">–ì–æ—Å—Ç—å</h3>
                <p id="profileUserId" style="color:var(--text-secondary); font-size:12px;">ID: –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</p>
            </div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:15px;">
            <div style="background:var(--bg-dark); padding:12px; border-radius:12px; text-align:center;">
                <div style="font-size:16px; font-weight:800; color:var(--primary); margin-bottom:3px;" id="profileBalance">0 ‚ÇΩ</div>
                <div style="color:var(--text-secondary); font-size:11px;">–ë–∞–ª–∞–Ω—Å</div>
            </div>
            <div style="background:var(--bg-dark); padding:12px; border-radius:12px; text-align:center;">
                <div style="font-size:16px; font-weight:800; color:var(--primary); margin-bottom:3px;" id="profileWins">0</div>
                <div style="color:var(--text-secondary); font-size:11px;">–ü–æ–±–µ–¥</div>
            </div>
        </div>
        <div style="display:flex; flex-direction:column; gap:8px;">
            <button onclick="window.depositModal?.()" style="padding:12px; background:var(--bg-dark); border:1px solid var(--border); border-radius:12px; color:white; display:flex; align-items:center; gap:8px; font-weight:600; cursor:pointer; width:100%;"><i class="fas fa-wallet"></i> –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            <button onclick="window.withdrawalModal?.()" style="padding:12px; background:var(--bg-dark); border:1px solid var(--border); border-radius:12px; color:white; display:flex; align-items:center; gap:8px; font-weight:600; cursor:pointer; width:100%;"><i class="fas fa-money-bill-wave"></i> –í—ã–≤–µ—Å—Ç–∏</button>
            <button onclick="window.open('https://t.me/orangew1nsupport', '_blank')" style="padding:12px; background:var(--bg-dark); border:1px solid var(--border); border-radius:12px; color:white; display:flex; align-items:center; gap:8px; font-weight:600; cursor:pointer; width:100%;"><i class="fas fa-headset"></i> –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
        </div>
    </div>

    <script>
        // ========== SUPABASE ==========
        const SUPABASE_URL = 'https://lllmhsatptxscjjoluov.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxsbG1oc2F0cHR4c2Nqam9sdW92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMjQ3NTksImV4cCI6MjA4NTkwMDc1OX0.wtzQkF54-HdALvDixNADLwoVqdw7AIPSOM4hmBISQ8U';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // ========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentBalance = 0;
        let currentBetAmount = 100;
        let userId = null;
        let gameHistory = [];
        
        let gameActive = false;
        let crashPoint = 1.0;
        let currentMultiplier = 1.0;
        let gameId = null;
        let gameInterval = null;
        let autoCashoutEnabled = false;
        let autoCashoutValue = 2.0;
        
        let lossStreak = 0;
        let gamesPlayed = 0;
        let winsCount = 0;
        
        const MAX_LOSS_STREAK = 3;
        const MIN_CRASH_POINT = 1.1;
        const MAX_CRASH_POINT = 100.0;
        const LOSS_BOOST = 0.2;
        
        // ========== –≠–õ–ï–ú–ï–ù–¢–´ ==========
        const balanceEl = document.getElementById('mainBalance');
        const profileBalanceEl = document.getElementById('profileBalance');
        const profileWinsEl = document.getElementById('profileWins');
        const betAmountInput = document.getElementById('betAmount');
        const startButton = document.getElementById('startButton');
        const cashoutButton = document.getElementById('cashoutButton');
        const autoToggle = document.getElementById('autoToggle');
        const autoCashoutSlider = document.getElementById('autoCashoutSlider');
        const autoCashoutValueElement = document.getElementById('autoCashoutValue');
        const multiplierDisplay = document.getElementById('multiplierDisplay');
        const statusMessage = document.getElementById('statusMessage');
        const crashGraph = document.getElementById('crashGraph');
        const graphLine = document.getElementById('graphLine');
        const crashPoints = document.getElementById('crashPoints');
        const historyList = document.getElementById('historyList');
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function initGame() {
            userId = localStorage.getItem('user_id');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
                localStorage.setItem('user_id', userId);
                localStorage.setItem('username', '–ò–≥—Ä–æ–∫');
            }
            
            const savedBalance = localStorage.getItem('user_balance');
            currentBalance = savedBalance ? parseInt(savedBalance) : 15780;
            localStorage.setItem('user_balance', currentBalance);
            
            const savedWins = localStorage.getItem('crash_wins');
            winsCount = savedWins ? parseInt(savedWins) : 0;
            
            loadStats();
            loadHistory();
            setupEventListeners();
            updateBalanceDisplay();
            updateAutoCashoutValue();
            updateProfileInfo();
            
            profileWinsEl.textContent = winsCount;
        }
        
        function loadStats() {
            const stats = localStorage.getItem('crash_stats');
            if (stats) {
                try {
                    const parsed = JSON.parse(stats);
                    lossStreak = parsed.lossStreak || 0;
                    gamesPlayed = parsed.gamesPlayed || 0;
                    winsCount = parsed.wins || 0;
                } catch(e) {}
            }
        }
        
        function saveStats() {
            const stats = {
                lossStreak,
                gamesPlayed,
                wins: winsCount,
                lastPlayed: new Date().toISOString()
            };
            localStorage.setItem('crash_stats', JSON.stringify(stats));
            profileWinsEl.textContent = winsCount;
        }
        
        function updateProfileInfo() {
            const username = localStorage.getItem('username') || '–ì–æ—Å—Ç—å';
            document.getElementById('profileUsername').textContent = username;
            document.getElementById('profileUserId').textContent = `ID: ${userId}`;
        }
        
        function updateBalanceDisplay() {
            const formatted = currentBalance.toLocaleString();
            balanceEl.textContent = formatted;
            profileBalanceEl.textContent = formatted + ' ‚ÇΩ';
            validateBet();
        }
        
        function updateAutoCashoutValue() {
            autoCashoutValue = parseFloat(autoCashoutSlider.value);
            autoCashoutValueElement.textContent = autoCashoutValue.toFixed(2) + 'x';
        }
        
        function setupEventListeners() {
            betAmountInput.addEventListener('input', () => {
                currentBetAmount = parseInt(betAmountInput.value) || 0;
                validateBet();
            });
            
            document.querySelectorAll('.quick-amount').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (this.id === 'halfBalance') {
                        currentBetAmount = Math.floor(currentBalance / 2);
                    } else if (this.id === 'maxBalance') {
                        currentBetAmount = currentBalance;
                    } else {
                        currentBetAmount = parseInt(this.dataset.amount);
                    }
                    betAmountInput.value = currentBetAmount;
                    validateBet();
                });
            });
            
            autoCashoutSlider.addEventListener('input', updateAutoCashoutValue);
            
            startButton.addEventListener('click', startGame);
            cashoutButton.addEventListener('click', cashout);
            
            autoToggle.addEventListener('click', function() {
                autoCashoutEnabled = !autoCashoutEnabled;
                this.classList.toggle('active', autoCashoutEnabled);
                this.innerHTML = autoCashoutEnabled 
                    ? '<i class="fas fa-robot"></i> –ê–í–¢–û –í–ö–õ' 
                    : '<i class="fas fa-robot"></i> –ê–í–¢–û';
                statusMessage.textContent = autoCashoutEnabled 
                    ? `–ê–≤—Ç–æ-–≤—ã–≤–æ–¥ –Ω–∞ ${autoCashoutValue.toFixed(2)}x`
                    : '–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢';
            });
            
            document.getElementById('balanceChip').addEventListener('click', () => showDepositModal());
            document.getElementById('avatarBtn').addEventListener('click', toggleProfile);
            document.getElementById('menuOverlay').addEventListener('click', closeProfile);
        }
        
        function validateBet() {
            if (currentBetAmount < 1) currentBetAmount = 1;
            if (currentBetAmount > currentBalance) currentBetAmount = currentBalance;
            betAmountInput.value = currentBetAmount;
            
            const isValid = currentBetAmount > 0 && currentBetAmount <= currentBalance;
            startButton.disabled = !isValid || gameActive;
            cashoutButton.disabled = !gameActive;
            
            if (!isValid && !gameActive) {
                startButton.innerHTML = '<i class="fas fa-exclamation-circle"></i> –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í';
            } else if (gameActive) {
                startButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ò–ì–†–ê –ò–î–Å–¢';
            } else {
                startButton.innerHTML = '<i class="fas fa-play"></i> –°–¢–ê–†–¢';
            }
        }
        
        // ========== –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–†–ê–®–ê –° –ü–û–î–ö–†–£–¢–ö–û–ô ==========
        function generateCrashPoint() {
            gamesPlayed++;
            
            let baseProbability = Math.random();
            if (lossStreak > 0) {
                const streakBoost = Math.min(0.5, lossStreak * LOSS_BOOST);
                baseProbability = Math.max(0.1, baseProbability - streakBoost);
            }
            
            let crashPoint;
            if (baseProbability < 0.7) {
                crashPoint = 1.1 + (Math.random() * 1.9);
            } else if (baseProbability < 0.9) {
                crashPoint = 3 + (Math.random() * 7);
            } else {
                crashPoint = 10 + (Math.random() * 90);
            }
            
            crashPoint = Math.max(MIN_CRASH_POINT, Math.min(MAX_CRASH_POINT, crashPoint));
            crashPoint = Math.round(crashPoint * 100) / 100;
            
            return crashPoint;
        }
        
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        function startGame() {
            if (gameActive || currentBetAmount > currentBalance) return;
            
            currentBalance -= currentBetAmount;
            localStorage.setItem('user_balance', currentBalance);
            updateBalanceDisplay();
            
            gameActive = true;
            currentMultiplier = 1.0;
            crashPoint = generateCrashPoint();
            gameId = 'CRASH_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
            
            multiplierDisplay.className = 'multiplier-display running';
            multiplierDisplay.textContent = '1.00x';
            statusMessage.textContent = '–ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–∞—Å—Ç—ë—Ç...';
            startButton.disabled = true;
            cashoutButton.disabled = false;
            betAmountInput.disabled = true;
            autoCashoutSlider.disabled = true;
            
            clearGraph();
            
            gameInterval = setInterval(updateGame, 50);
        }
        
        function clearGraph() {
            graphLine.style.transform = 'scaleX(0)';
            crashPoints.innerHTML = '';
        }
        
        function updateGame() {
            currentMultiplier += 0.01;
            multiplierDisplay.textContent = currentMultiplier.toFixed(2) + 'x';
            
            const progress = Math.min(1, (currentMultiplier - 1) / (crashPoint - 1));
            graphLine.style.transform = `scaleX(${progress})`;
            
            if (autoCashoutEnabled && currentMultiplier >= autoCashoutValue) {
                cashout();
                return;
            }
            
            if (currentMultiplier >= crashPoint) {
                crash();
            }
        }
        
        function cashout() {
            if (!gameActive) return;
            
            const winAmount = Math.floor(currentBetAmount * currentMultiplier);
            const profit = winAmount - currentBetAmount;
            
            currentBalance += winAmount;
            winsCount++;
            lossStreak = 0;
            
            localStorage.setItem('user_balance', currentBalance);
            localStorage.setItem('crash_wins', winsCount);
            updateBalanceDisplay();
            
            endGame(true, winAmount, profit);
            showResultModal(true, profit, currentMultiplier);
            
            saveStats();
        }
        
        function crash() {
            if (!gameActive) return;
            
            lossStreak++;
            
            multiplierDisplay.className = 'multiplier-display crashed';
            addCrashPointToGraph();
            
            endGame(false, 0, -currentBetAmount);
            showResultModal(false, currentBetAmount, crashPoint);
            
            saveStats();
        }
        
        function addCrashPointToGraph() {
            const point = document.createElement('div');
            point.className = 'crash-point';
            point.innerHTML = `<i class="fas fa-bomb"></i> ${crashPoint.toFixed(2)}x`;
            crashPoints.appendChild(point);
        }
        
        function endGame(isWin, amount, profit) {
            gameActive = false;
            clearInterval(gameInterval);
            
            startButton.disabled = false;
            cashoutButton.disabled = true;
            betAmountInput.disabled = false;
            autoCashoutSlider.disabled = false;
            
            if (isWin) {
                multiplierDisplay.className = 'multiplier-display';
                statusMessage.textContent = `–í—ã–≤–æ–¥ –Ω–∞ ${currentMultiplier.toFixed(2)}x!`;
            } else {
                statusMessage.textContent = `–ö—Ä–∞—à –Ω–∞ ${crashPoint.toFixed(2)}x`;
            }
            
            addHistoryItem(isWin, isWin ? currentMultiplier : crashPoint, profit);
            saveGameToDB(isWin, amount, profit);
            
            setTimeout(() => {
                multiplierDisplay.className = 'multiplier-display waiting';
                multiplierDisplay.textContent = '1.00x';
                statusMessage.textContent = autoCashoutEnabled 
                    ? `–ê–≤—Ç–æ-–≤—ã–≤–æ–¥ –Ω–∞ ${autoCashoutValue.toFixed(2)}x`
                    : '–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢';
            }, 3000);
            
            validateBet();
        }
        
        function addHistoryItem(isWin, multiplier, profit) {
            const item = document.createElement('div');
            item.className = `history-item ${isWin ? 'history-cashout' : 'history-crash'}`;
            
            if (isWin) {
                item.innerHTML = `<i class="fas fa-check-circle"></i> ${multiplier.toFixed(2)}x`;
                item.title = `–í—ã–≤–æ–¥ –Ω–∞ ${multiplier.toFixed(2)}x | +${profit.toLocaleString()}‚ÇΩ`;
            } else {
                item.innerHTML = `<i class="fas fa-bomb"></i> ${multiplier.toFixed(2)}x`;
                item.title = `–ö—Ä–∞—à –Ω–∞ ${multiplier.toFixed(2)}x | -${Math.abs(profit).toLocaleString()}‚ÇΩ`;
            }
            
            historyList.insertBefore(item, historyList.firstChild);
            if (historyList.children.length > 15) {
                historyList.removeChild(historyList.lastChild);
            }
            
            gameHistory.unshift({
                isWin,
                multiplier,
                profit,
                bet: currentBetAmount,
                timestamp: Date.now()
            });
            localStorage.setItem('crash_history', JSON.stringify(gameHistory.slice(0, 50)));
        }
        
        function loadHistory() {
            const saved = localStorage.getItem('crash_history');
            if (saved) {
                try {
                    gameHistory = JSON.parse(saved);
                    gameHistory.slice(0, 15).forEach(game => {
                        const item = document.createElement('div');
                        item.className = `history-item ${game.isWin ? 'history-cashout' : 'history-crash'}`;
                        if (game.isWin) {
                            item.innerHTML = `<i class="fas fa-check-circle"></i> ${game.multiplier.toFixed(2)}x`;
                        } else {
                            item.innerHTML = `<i class="fas fa-bomb"></i> ${game.multiplier.toFixed(2)}x`;
                        }
                        historyList.appendChild(item);
                    });
                } catch(e) {}
            }
        }
        
        async function saveGameToDB(isWin, winAmount, profit) {
            if (!userId) return;
            try {
                await supabaseClient.from('crash_history').insert({
                    id: gameId,
                    user_id: userId,
                    user_name: localStorage.getItem('username') || '–ò–≥—Ä–æ–∫',
                    bet_amount: currentBetAmount,
                    is_win: isWin,
                    win_amount: winAmount,
                    profit: profit,
                    crash_multiplier: crashPoint,
                    cashout_multiplier: isWin ? currentMultiplier : null,
                    balance_after: currentBalance,
                    created_at: new Date().toISOString()
                });
            } catch(e) { console.error('DB error:', e); }
        }
        
        // ========== –ú–û–î–ê–õ–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê ==========
        function showResultModal(isWin, amount, multiplier) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top:0; left:0; width:100%; height:100%;
                background: rgba(0,0,0,0.95); display:flex; justify-content:center;
                align-items:center; z-index:2000; backdrop-filter:blur(5px);
            `;
            modal.innerHTML = `
                <div style="background: var(--bg-card); border-radius:20px; padding:30px; text-align:center; max-width:400px; width:90%; border:2px solid var(--border); box-shadow:0 20px 50px rgba(0,0,0,0.7);">
                    <div style="width:80px; height:80px; border-radius:50%; background:${isWin ? 'var(--success-gradient)' : 'var(--danger-gradient)'}; display:flex; align-items:center; justify-content:center; margin:0 auto 20px; font-size:36px; color:white;">
                        <i class="fas ${isWin ? 'fa-check-circle' : 'fa-bomb'}"></i>
                    </div>
                    <h2 style="font-size:24px; font-weight:900; margin-bottom:10px;">${isWin ? '–í–´–í–û–î!' : '–ö–†–ê–®!'}</h2>
                    <p style="color:var(--text-secondary); margin-bottom:20px;">${isWin ? `–í—ã–≤–æ–¥ –Ω–∞ ${multiplier.toFixed(2)}x` : `–ö—Ä–∞—à –Ω–∞ ${multiplier.toFixed(2)}x`}</p>
                    <div style="font-size:32px; font-weight:900; margin-bottom:25px; color:${isWin ? 'var(--success)' : 'var(--danger)'};">
                        ${isWin ? '+' : '-'}${Math.abs(amount).toLocaleString()} ‚ÇΩ
                    </div>
                    <button id="closeModal" style="width:100%; padding:16px; background:var(--gradient); border:none; border-radius:12px; color:white; font-weight:900; font-size:16px; cursor:pointer;">
                        ${isWin ? '–ò–ì–†–ê–¢–¨ –ï–©–Å' : '–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê'}
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('closeModal').onclick = () => modal.remove();
            setTimeout(() => modal.remove(), 5000);
        }
        
        // ========== –ü–†–û–§–ò–õ–¨ ==========
        let isProfileOpen = false;
        function toggleProfile() {
            const menu = document.getElementById('profileMenu');
            const overlay = document.getElementById('menuOverlay');
            isProfileOpen = !isProfileOpen;
            menu.classList.toggle('active', isProfileOpen);
            overlay.classList.toggle('active', isProfileOpen);
            updateProfileInfo();
            profileBalanceEl.textContent = currentBalance.toLocaleString() + ' ‚ÇΩ';
            profileWinsEl.textContent = winsCount;
        }
        function closeProfile() {
            document.getElementById('profileMenu').classList.remove('active');
            document.getElementById('menuOverlay').classList.remove('active');
            isProfileOpen = false;
        }
        
        // ========== –ú–û–î–ê–õ–ö–ò –ò–ó INDEX ==========
        function showDepositModal() {
            closeProfile();
            const isMobile = window.innerWidth <= 768;
            const modal = document.createElement('div');
            modal.style.cssText = `position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:flex; justify-content:center; align-items:center; z-index:1002; backdrop-filter:blur(3px); padding:15px; overflow-y:auto;`;
            modal.innerHTML = `
                <div style="background: var(--bg-card); border-radius:16px; padding:${isMobile?'20px':'25px'}; width:${isMobile?'95%':'380px'}; max-width:420px; border:1px solid var(--border); box-shadow:0 15px 40px rgba(0,0,0,0.5); position:relative; max-height:90vh; overflow-y:auto;">
                    <div style="position:absolute; top:${isMobile?'10px':'15px'}; right:${isMobile?'10px':'15px'}; color:var(--text-secondary); font-size:${isMobile?'20px':'22px'}; cursor:pointer; width:${isMobile?'32px':'36px'}; height:${isMobile?'32px':'36px'}; display:flex; align-items:center; justify-content:center; border-radius:8px; background:rgba(255,107,0,0.05);" id="closeDepModal">&times;</div>
                    <div style="text-align:center; margin-bottom:15px; padding-right:${isMobile?'25px':'30px'};">
                        <div style="width:${isMobile?'45px':'50px'}; height:${isMobile?'45px':'50px'}; background:var(--gradient); border-radius:${isMobile?'10px':'12px'}; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-size:${isMobile?'18px':'20px'}; color:white;"><i class="fas fa-wallet"></i></div>
                        <h2 style="color:var(--text-primary); margin-bottom:5px; font-size:${isMobile?'18px':'20px'};">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –°–ë–ü</h2>
                        <p style="color:var(--text-secondary); font-size:${isMobile?'12px':'13px'};">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <span style="color:var(--primary); font-weight:700;" id="modalBalance">${currentBalance.toLocaleString()} ‚ÇΩ</span></p>
                    </div>
                    <div style="margin-bottom:15px;">
                        <div style="color:var(--text-secondary); margin-bottom:8px; font-size:${isMobile?'11px':'12px'}; font-weight:600;">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (‚ÇΩ)</div>
                        <input type="number" id="depositAmount" style="width:100%; padding:${isMobile?'12px':'14px'}; background:var(--bg-dark); border:1px solid var(--border); border-radius:${isMobile?'8px':'10px'}; color:var(--text-primary); font-size:${isMobile?'15px':'16px'}; outline:none; font-weight:600;" placeholder="1000" min="100" value="1000">
                    </div>
                    <div style="display:grid; grid-template-columns:repeat(${isMobile?'2':'3'},1fr); gap:8px; margin-bottom:15px;">
                        <button class="quick-deposit" data-amount="500" style="padding:${isMobile?'10px 5px':'10px 5px'}; background:var(--bg-dark); border:1px solid var(--border); border-radius:8px; color:var(--text-primary); font-weight:600; cursor:pointer; font-size:${isMobile?'12px':'13px'};">500 ‚ÇΩ</button>
                        <button class="quick-deposit" data-amount="1000" style="padding:${isMobile?'10px 5px':'10px 5px'}; background:var(--bg-dark); border:1px solid var(--border); border-radius:8px; color:var(--text-primary); font-weight:600; cursor:pointer; font-size:${isMobile?'12px':'13px'};">1 000 ‚ÇΩ</button>
                        <button class="quick-deposit" data-amount="2000" style="padding:${isMobile?'10px 5px':'10px 5px'}; background:var(--bg-dark); border:1px solid var(--border); border-radius:8px; color:var(--text-primary); font-weight:600; cursor:pointer; font-size:${isMobile?'12px':'13px'};">2 000 ‚ÇΩ</button>
                        <button class="quick-deposit" data-amount="3000" style="padding:${isMobile?'10px 5px':'10px 5px'}; background:var(--bg-dark); border:1px solid var(--border); border-radius:8px; color:var(--text-primary); font-weight:600; cursor:pointer; font-size:${isMobile?'12px':'13px'};">3 000 ‚ÇΩ</button>
                        <button class="quick-deposit" data-amount="5000" style="padding:${isMobile?'10px 5px':'10px 5px'}; background:var(--bg-dark); border:1px solid var(--border); border-radius:8px; color:var(--text-primary); font-weight:600; cursor:pointer; font-size:${isMobile?'12px':'13px'};">5 000 ‚ÇΩ</button>
                        <button class="quick-deposit" data-amount="10000" style="padding:${isMobile?'10px 5px':'10px 5px'}; background:var(--bg-dark); border:1px solid var(--border); border-radius:8px; color:var(--text-primary); font-weight:600; cursor:pointer; font-size:${isMobile?'12px':'13px'};">10 000 ‚ÇΩ</button>
                    </div>
                    <button id="confirmDeposit" style="width:100%; padding:${isMobile?'14px':'15px'}; background:var(--gradient); border:none; border-radius:${isMobile?'8px':'10px'}; color:white; font-weight:800; font-size:${isMobile?'14px':'15px'}; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;"><i class="fas fa-arrow-right"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</button>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('#closeDepModal').onclick = () => modal.remove();
            modal.addEventListener('click', e => { if(e.target === modal) modal.remove(); });
            modal.querySelectorAll('.quick-deposit').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    modal.querySelector('#depositAmount').value = this.dataset.amount;
                });
            });
            modal.querySelector('#confirmDeposit').onclick = function(e) {
                e.stopPropagation();
                const amount = parseInt(modal.querySelector('#depositAmount').value);
                if(amount < 100) { alert('–ú–∏–Ω–∏–º—É–º 100 ‚ÇΩ'); return; }
                modal.remove();
                localStorage.setItem('sbp_amount', amount);
                window.location.href = 'sbp.html';
            };
        }
        
        function showWithdrawalModal() {
            closeProfile();
            alert('–í—ã–≤–æ–¥ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –°–∫–æ—Ä–æ –æ—Ç–∫—Ä–æ–µ–º!');
        }
        
        window.depositModal = showDepositModal;
        window.withdrawalModal = showWithdrawalModal;
        
        function goBack() {
            window.location.href = 'index.html';
        }
        
        // ========== –°–¢–ê–†–¢ ==========
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            
            window.addEventListener('beforeunload', () => {
                localStorage.setItem('user_balance', currentBalance);
                saveStats();
            });
            
            window.addEventListener('focus', () => {
                const saved = localStorage.getItem('user_balance');
                if (saved && parseInt(saved) !== currentBalance) {
                    currentBalance = parseInt(saved);
                    updateBalanceDisplay();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space' && gameActive && !cashoutButton.disabled) {
                    e.preventDefault();
                    cashout();
                }
                if (e.code === 'Enter' && !gameActive && !startButton.disabled) {
                    e.preventDefault();
                    startGame();
                }
            });
        });
    </script>
</body>
</html>
